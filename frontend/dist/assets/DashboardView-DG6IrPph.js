import{d as K,o as P,w as V,c as o,a as t,F as k,b as $,e as S,v as j,t as a,f as C,r as _,g as M,h as p,i as r,j as l,_ as D}from"./index-DZgEsRqK.js";import{u as N}from"./planning--bhoTUz1.js";import"./client-CnkACndt.js";const A={class:"page-content-inner"},B={key:0,class:"content-section"},E={class:"content-section"},F={class:"content-section"},I={key:0,class:"muted"},L={key:1,class:"risk-summary"},T={class:"content-section"},q={key:0,class:"muted"},O={key:1,class:"risk-summary"},z={class:"content-section"},G=["value"],H={key:0,class:"app-table-wrap"},J={class:"app-table"},Q={key:1,class:"muted"},X={class:"content-section"},Y={class:"app-table-wrap"},Z={class:"app-table"},ee=8,te=13,se=K({__name:"DashboardView",setup(ne){const u=N(),f=p(!0),v=p("baseline"),i=p(null),h=r(()=>u.planRuns),c=p([]),w=r(()=>{const n=new Set(c.value.map(e=>e.week_start));return Array.from(n).sort()}),y=r(()=>w.value.slice(0,ee)),b=r(()=>w.value.slice(0,te)),W=r(()=>c.value.filter(n=>n.stockout&&y.value.includes(n.week_start)).length),g=r(()=>c.value.filter(n=>n.stockout&&b.value.includes(n.week_start)).length),R=r(()=>{const n=new Set;return c.value.filter(e=>e.stockout&&y.value.includes(e.week_start)).forEach(e=>n.add(`${e.sku}|${e.warehouse_code}`)),Array.from(n)}),x=r(()=>{const n=new Set;return c.value.filter(e=>e.stockout&&b.value.includes(e.week_start)).forEach(e=>n.add(`${e.sku}|${e.warehouse_code}`)),Array.from(n)}),m=r(()=>{const n={};for(const e of c.value){const s=`${e.sku}|${e.warehouse_code}`;n[s]||(n[s]={sku:e.sku,warehouse_code:e.warehouse_code,stockoutWeeks:0,minWoc:999}),e.stockout&&n[s].stockoutWeeks++;const d=e.weeks_of_cover?parseFloat(e.weeks_of_cover):999;d<n[s].minWoc&&(n[s].minWoc=d)}return Object.values(n).filter(e=>e.stockoutWeeks>0).sort((e,s)=>s.stockoutWeeks-e.stockoutWeeks).slice(0,20)});async function U(){await u.runPlan(v.value),await u.fetchPlanRuns(),u.planRuns.length&&(i.value=u.planRuns[0].id)}return P(async()=>{await u.fetchPlanRuns(),u.planRuns.length&&(i.value=u.planRuns[0].id),f.value=!1}),V(i,async n=>{n?c.value=await u.fetchProjectedInventory(n):c.value=[]},{immediate:!0}),(n,e)=>(l(),o("div",A,[e[11]||(e[11]=t("p",{class:"muted"},"Stockout risk next 8 / 13 weeks and top SKUs by risk.",-1)),f.value?(l(),o("section",B,"Loading...")):(l(),o(k,{key:1},[t("section",E,[e[3]||(e[3]=t("h2",null,"Run a scenario",-1)),t("form",{onSubmit:$(U,["prevent"]),class:"form-inline"},[S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),class:"app-input",placeholder:"Scenario name",required:"",style:{"max-width":"12rem"}},null,512),[[j,v.value]]),e[2]||(e[2]=t("button",{type:"submit",class:"app-btn app-btn-primary"},"Run plan",-1))],32)]),t("section",F,[e[4]||(e[4]=t("h2",null,"Stockout risk (next 8 weeks)",-1)),i.value?(l(),o("div",L,[t("p",null,"Stockouts: "+a(W.value),1),t("p",null,"SKU/Warehouse combinations at risk: "+a(R.value.length),1)])):(l(),o("p",I,"Select a scenario below to see risk."))]),t("section",T,[e[5]||(e[5]=t("h2",null,"Stockout risk (next 13 weeks)",-1)),i.value?(l(),o("div",O,[t("p",null,"Stockouts: "+a(g.value),1),t("p",null,"SKU/Warehouse at risk: "+a(x.value.length),1)])):(l(),o("p",q,"Select a scenario below."))]),t("section",z,[e[8]||(e[8]=t("h2",null,"Top SKUs by risk",-1)),S(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),class:"app-select",style:{"max-width":"20rem","margin-bottom":"0.5rem"}},[e[6]||(e[6]=t("option",{value:null},"Select scenario",-1)),(l(!0),o(k,null,_(h.value,s=>(l(),o("option",{key:s.id,value:s.id},a(s.scenario_name)+" ("+a(s.created_at)+")",9,G))),128))],512),[[C,i.value]]),i.value&&m.value.length?(l(),o("div",H,[t("table",J,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"SKU"),t("th",null,"Warehouse"),t("th",null,"Weeks at risk"),t("th",null,"Min weeks of cover")])],-1)),t("tbody",null,[(l(!0),o(k,null,_(m.value,(s,d)=>(l(),o("tr",{key:d},[t("td",null,a(s.sku),1),t("td",null,a(s.warehouse_code),1),t("td",null,a(s.stockoutWeeks),1),t("td",null,a(s.minWoc),1)]))),128))])])])):i.value&&!m.value.length?(l(),o("p",Q,"No stockout risk in projection.")):M("",!0)]),t("section",X,[e[10]||(e[10]=t("h2",null,"Plan runs",-1)),t("div",Y,[t("table",Z,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Scenario"),t("th",null,"Run at"),t("th",null,"Created")])],-1)),t("tbody",null,[(l(!0),o(k,null,_(h.value,s=>(l(),o("tr",{key:s.id},[t("td",null,a(s.scenario_name),1),t("td",null,a(s.run_at),1),t("td",null,a(s.created_at),1)]))),128))])])])])],64))]))}}),ue=D(se,[["__scopeId","data-v-20c74493"]]);export{ue as default};
