import{d as g,c as o,l as m,a as t,e as k,f as C,t as n,F as V,r as S,g as f,h as u,j as r,_ as I}from"./index-DZgEsRqK.js";import{a as w}from"./client-CnkACndt.js";const D={class:"page-content-inner"},F={class:"content-section"},R={class:"actions"},x=["disabled"],N=["disabled"],T={key:0,class:"content-section result"},B={key:0,class:"errors"},P={class:"app-table-wrap"},U={class:"app-table"},j={key:1,class:"preview"},E=g({__name:"ImportsView",setup($){const p=u("inventory-snapshots"),c=u(null),l=u(null),e=u(null);function y(s){var i;const a=s.target;l.value=((i=a.files)==null?void 0:i[0])??null,e.value=null}async function h(){if(!l.value)return;const s=new FormData;s.append("file",l.value);const{data:a}=await w.post(`/import/${p.value}?dry_run=true`,s,{headers:{"Content-Type":"multipart/form-data"}});e.value=a}async function _(){if(!l.value)return;const s=new FormData;s.append("file",l.value);const{data:a}=await w.post(`/import/${p.value}?dry_run=false`,s,{headers:{"Content-Type":"multipart/form-data"}});e.value=a,l.value=null,c.value&&(c.value.value="")}return(s,a)=>{var i,v,b;return r(),o("div",D,[a[7]||(a[7]=m('<p class="muted" data-v-7fb9cfb3>Upload CSV with dry-run validation. Fix row errors then confirm import.</p><section class="content-section" data-v-7fb9cfb3><h2 data-v-7fb9cfb3>CSV templates (download)</h2><ul class="template-links" data-v-7fb9cfb3><li data-v-7fb9cfb3><a href="/api/templates/inventory-snapshots" download data-v-7fb9cfb3>Inventory snapshots</a></li><li data-v-7fb9cfb3><a href="/api/templates/receipts" download data-v-7fb9cfb3>Receipts</a></li><li data-v-7fb9cfb3><a href="/api/templates/demand-actuals" download data-v-7fb9cfb3>Demand actuals</a></li><li data-v-7fb9cfb3><a href="/api/templates/samples-withdrawals" download data-v-7fb9cfb3>Samples withdrawals</a></li><li data-v-7fb9cfb3><a href="/api/templates/products" download data-v-7fb9cfb3>Products</a></li></ul></section>',2)),t("section",F,[a[2]||(a[2]=t("h2",null,"Upload",-1)),k(t("select",{"onUpdate:modelValue":a[0]||(a[0]=d=>p.value=d),class:"app-select",style:{"max-width":"18rem","margin-bottom":"0.5rem"}},[...a[1]||(a[1]=[m('<option value="inventory-snapshots" data-v-7fb9cfb3>Inventory snapshots</option><option value="receipts" data-v-7fb9cfb3>Receipts</option><option value="demand-actuals" data-v-7fb9cfb3>Demand actuals</option><option value="samples-withdrawals" data-v-7fb9cfb3>Samples withdrawals</option><option value="products" data-v-7fb9cfb3>Products</option>',5)])],512),[[C,p.value]]),t("input",{type:"file",ref_key:"fileInput",ref:c,accept:".csv",onChange:y,class:"file-input"},null,544),t("div",R,[t("button",{type:"button",onClick:h,disabled:!l.value,class:"app-btn app-btn-primary"},"Dry run (validate)",8,x),t("button",{type:"button",onClick:_,disabled:!l.value||!((i=e.value)!=null&&i.valid_rows),class:"app-btn app-btn-primary btn-confirm"},"Confirm import",8,N)])]),e.value?(r(),o("section",T,[a[6]||(a[6]=t("h2",null,"Result",-1)),t("p",null,"Valid: "+n(e.value.valid?"Yes":"No"),1),t("p",null,"Total rows: "+n(e.value.total_rows),1),t("p",null,"Valid rows: "+n(e.value.valid_rows),1),(v=e.value.errors)!=null&&v.length?(r(),o("div",B,[a[4]||(a[4]=t("h3",null,"Row errors",-1)),t("div",P,[t("table",U,[a[3]||(a[3]=t("thead",null,[t("tr",null,[t("th",null,"Row"),t("th",null,"Errors")])],-1)),t("tbody",null,[(r(!0),o(V,null,S(e.value.errors,d=>(r(),o("tr",{key:d.row},[t("td",null,n(d.row),1),t("td",null,n(d.errors.join(", ")),1)]))),128))])])])])):f("",!0),(b=e.value.preview)!=null&&b.length?(r(),o("div",j,[a[5]||(a[5]=t("h3",null,"Preview (first 5 rows)",-1)),t("pre",null,n(JSON.stringify(e.value.preview,null,2)),1)])):f("",!0)])):f("",!0)])}}}),M=I(E,[["__scopeId","data-v-7fb9cfb3"]]);export{M as default};
